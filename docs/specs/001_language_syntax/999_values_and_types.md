
---

### immutable

値には、不変なもの（イミュータブル）と可変なもの（ミュータブル）があります。

不変な値とは、生成した時点の状態を後から変更できないものを言います。

いわゆる「定数」に近いもので、定義後に値を変更できないようなものです。
定数が「変更できない変数」であるのに対し、ここでいう `immutable` は、値が変更できないオブジェクトを意味します。

キーたん語では、**連想配列（`array`）と添字配列（`map`）を除き、基本的に全てが不変（イミュータブル）な値です**。

```go
s := "12345"   // s のオブジェクトに string 型の値を代入する
s[1] = 'b'     // NG: 文字列型は不変です

a := [1, 2, 3] // a --> array 型
a[1] = "two"   // OK: `a` は `[1, "two", 3]` になります
```

`array` 型や `map` 型の値を不変にしたい場合は、`immutable()` を使って不変化させたものを使います。

```go
b := immutable([1, 2, 3])
b[1] = "foo"   // NG: 'b' は不変化された array が入ったオブジェクトです
```

とは言え、キーたん語は、そこまで「型々」言う言語ではありません。新しい値を既存の変数（オブジェクト）に代入することは可能です。

```go
s := "abc"
s = "foo"                  // OK
a := immutable([1, 2, 3])
a = false                  // OK
```

なお、不変の値を `copy()` を使ってコピーすると、「可変」のコピーが返されます。

```go
a := immutable([1, 2, 3])
a[1] = "foo"   // NG: 'a' は不変化された array が入ったオブジェクトです

b := copy(a)
b[1] = "foo"   // OK: `b` は `[1, "foo", 3]` になります
```

また，連想配列（`array`）や添字配列（`map`）の値の個々の要素には，明示的に不変性が設定されていない限り，不変性は適用されません。

```go
a := immutable({b: 4, c: [1, 2, 3]})
a.b = 5        // NG: 'a.b' は string で不変なため
a.c[1] = 5     // OK: 'a.c' は不変化されていないため

a = immutable({b: 4, c: immutable([1, 2, 3])})
a.c[1] = 5     // NG
```

> [目次に戻る ↩️](../)

---

### error

キーたん語では、エラーは "`error`" という型の値で表されます。

エラーは `error()` を使用して作成され、基礎となる型の値を持たなければなりません。エラー値の基礎となる値は、`.value` セレクタを使ってアクセスできます。

```go
err1 := error("oops")    // string 型の値を持つエラー型
err2 := error(1+2+3)     // int 型の値を持つエラー型

// 'is_error' は組み込み関数で、引数がエラー型の場合に true を返します。
if is_error(err1) {
  err_val := err1.value  // err1 に内在する値を取得し err_val に代入
}
```

> [目次に戻る ↩️](../)

---

### undefined

キーたん語では、"`undefined`" 型の値は、予想外の値や存在しない値を表すのに使われます。

- 明示的に値を返さない関数は、暗黙的に `undefined` の値を返します。
- `array` や `map` などの複合値型で、キーやインデックスが存在しない場合、`undefined` を返すことがあります。
- 型変換の組み込み関数で、デフォルト値がない場合は、変換に失敗すると `undefined` を返します。

```go
a := func() { b := 4 }()    // a --> undefined
b := [1, 2, 3][10]          // b --> undefined
c := {a: "foo"}["b"]        // c --> undefined
d := int("foo")             // d --> undefined
```

> [目次に戻る ↩️](../)

---

---

> [目次に戻る ↩️](../)
